# Техническое задание: eOselya 2.0 (Web Application)

## 1. Анализ текущего состояния (eOselya 1.0)

### 1.1. Суть проекта
**eOselya** — это инструмент для финансового моделирования инвестиций в жилую недвижимость с использованием ипотечного кредитования (программа "єОселя" или рыночная ипотека).

**Ключевая особенность:** Моделирование мультивалютной среды, где:
- Доход (аренда) и актив (квартира) номинированы в USD (или привязаны к нему).
- Кредит номинирован в UAH.
- Учитывается инфляция UAH и девальвация курса.

### 1.2. Текущий функционал
- **Расчеты:** Дифференцированный график платежей, NPV, IRR, ROI, Cashflow.
- **Сценарии:** Поддержка 3 сценариев (Пессимистичный, Базовый, Оптимистичный) с разными параметрами инфляции и роста цен.
- **Интерфейс:** CLI (Command Line Interface). Запуск через терминал, конфигурация через JSON.
- **Вывод:** Excel-отчеты, CSV файлы, консольный вывод.

### 1.3. Недостатки текущей версии
- **Сложность входа:** Требует установки Python и работы с командной строкой.
- **Отсутствие интерактивности:** Нельзя "покрутить" параметры на лету (нужно менять конфиг и перезапускать).
- **Визуализация:** Графики только в Excel, нет веб-дашборда.
- **Ограниченный функционал:** Нет учета налогов, вакантности, детальных расходов на ремонт.

---

## 2. Концепция eOselya 2.0

**Цель:** Создать современное веб-приложение, доступное для широкого круга инвесторов, риелторов и покупателей жилья, позволяющее моделировать инвестиционные стратегии в реальном времени.

### 2.1. Целевая аудитория
- Частные инвесторы.
- Риелторы (для демонстрации расчетов клиентам).
- Покупатели по программе "єОселя".

### 2.2. Технологический стек
- **Frontend:** Next.js (React), TailwindCSS, Shadcn/UI (компоненты), Recharts (графики).
- **Backend:** Python (FastAPI) — для переиспользования проверенной финансовой логики текущей версии.
- **Database:** PostgreSQL (хранение сценариев пользователей, истории расчетов).
- **Deployment:** Vercel (Frontend) + Railway/Render (Backend).

---

## 3. Функциональные требования

### 3.1. Интерфейс и UX
- **Дашборд:** Главный экран с ключевыми метриками (NPV, IRR, ROI, Cashflow).
- **Форма ввода:** Удобная форма с группировкой полей (Объект, Кредит, Аренда, Макроэкономика).
- **Слайдеры:** Возможность менять ключевые параметры (ставка, срок, первый взнос) ползунками и видеть мгновенное обновление графиков.
- **Сравнение:** Режим "Split View" для сравнения двух объектов или стратегий рядом.

### 3.2. Финансовое ядро (Улучшения)
- **Амортизация (Ремонт/Обслуживание):**
  - Вместо детального калькулятора использовать упрощенную модель: "Коэффициент амортизации" (в месяцах аренды).
  - **Логика:** Годовые расходы на амортизацию = `Rent_Monthly * Amortization_Coefficient`.
  - **Default:** 1.0 (т.е. 1 месяц аренды в год уходит на ремонт/обслуживание).
  - Возможность редактировать этот коэффициент (например, 0.5 или 2.0).
- **Тип платежей:** Выбор между Аннуитетом и Дифференцированным платежом.

### 3.3. Аналитика
- **Анализ чувствительности:** Тепловая карта (Heatmap) зависимости NPV от двух параметров (например, Инфляция vs Рост Аренды).

---

## 4. Детальный план разработки

### Этап 1: MVP (Web Interface для текущего ядра)
1. **Backend API:**
   - Обернуть текущий код (`main.py`, `cashflow.py` и др.) в FastAPI.
   - Создать эндпоинт `/calculate`, принимающий JSON и возвращающий метрики и массивы для графиков.
2. **Frontend:**
   - Создать проект на Next.js.
   - Реализовать форму ввода параметров.
   - Реализовать отображение результатов (Карточки метрик + График Cashflow).

### Этап 2: Расширение функционала
1. **Доработка ядра:**
   - Реализовать логику "Коэффициента амортизации" в `cashflow.py` (заменить текущий фиксированный % от стоимости).
   - Реализовать логику аннуитетных платежей в `schedule.py`.
2. **Frontend:**
   - Добавить поле ввода "Амортизация (мес. аренды)".
   - Добавить переключатель типа платежей.

### Этап 3: Интерактивность
1. **Слайдеры:** Реализовать debounced-запросы к API при перетаскивании слайдеров.

---

## 5. Требования к качеству кода
- **Type Hinting:** Строгая типизация (Pydantic для API).
- **Testing:** Unit-тесты для финансовой математики (pytest).
- **CI/CD:** Автоматический деплой и прогон тестов.
- **Documentation:** Swagger/OpenAPI для бэкенда.

---

## 6. Исправления текущей версии (Maintenance)
В ходе анализа текущей версии (`eOselya 1.0`) критических ошибок не выявлено. Код структурирован, логика прозрачна.
**Рекомендованные мелкие правки:**
1. Добавить `.gitignore` для исключения `output/` (уже есть, но проверить).
2. В `requirements.txt` зафиксировать версии библиотек (`pandas==2.x.x`).
3. Добавить обработку ошибок при некорректном JSON конфиге (более детальные сообщения).

---

**Итог:** Переход на веб-платформу позволит масштабировать продукт и сделать его удобным инструментом для массового пользователя, сохранив при этом мощное математическое ядро.
